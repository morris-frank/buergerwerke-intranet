<% title 'Kundendaten der ' + @cooperative.name %>

<p class="title"><%= yield :title %></p>

<nav class="level">
  <div class="level-left">
    <div class="level-item">
      <a class=""  href="<%= url_for controller: 'cooperatives', action: 'show', id: @cooperative.id %>">
        <span class="icon"><i class="fas fa-chevron-left"></i></span>
        <span>zur√ºck</span>
      </a>
    </div>
  </div>
  <div class="level-right">
    <div class="level-item has-text-centered">
      <div>
        <p class="heading">Anzahl Kunden</p>
        <p class=""><%= @cooperative.customer_count %></p>
      </div>
    </div>
    <div class="level-item has-text-centered">
      <div>
        <p class="heading">Aktualisiert vor</p>
        <p class=""><%= (@cooperative.last_customer_update) ? time_ago_in_words(@cooperative.last_customer_update) : 'nie' %></p>
      </div>
    </div>

    <% if @cooperative.customer_data_pdf.attached? %>
    <div class="level-item">
      <a href="<%= rails_blob_path(@cooperative.customer_data_pdf, disposition: "attachment") %>">
        <span class="icon"><i class="fas fa-cloud-download-alt"></i></span>
        <span>PDF</span>
      </a>
    </div>
    <% end %>
  </div>
</nav>

<div id="customer-data-table">
  <div class="tags selectors" data-target="customer-data-table">
    <% @attributes.each do |attribute| %>
    <span data-target="<%= attribute %>" class="tag<%= (@active_attributes.include? attribute) ? ' is-primary' : ' is-light' %>" title="<%= t 'customer_data.attribute_legend.' + attribute.to_s  %>">
      <%= CustomerDatum.human_attribute_name(attribute) %>
    </span>
    <% end %>
  </div>

  <%= form_for_filterrific @filterrific do |f| %>
  <div class="field is-grouped">
    <p class="control has-icons-left is-expanded">
      <span class="icon is-small is-left">
        <i class="fas fa-search"></i>
      </span>
      <%= f.text_field(
        :search_query,
        class: 'input filterrific-periodically-observed',
        placeholder: 'Filter'
      ) %>
    </p>
    <div class="control">
      <%= button_to t('reset'), reset_filterrific_url, class: "button is-link" %>
    </div>
  </div>
  <% end %>

  <div class="scroller"><div></div></div>
  <div class="table-container">
    <table class="table is-fullwidth is-striped is-hoverable">
      <colgroup>
        <% @attributes.each do |attribute| %>
        <col class="<%= attribute %> <%= (@active_attributes.include? attribute) ? '' : 'is-inactive' %>">
        <% end %>
      </colgroup>

      <thead>
        <tr>
          <% @attributes.each do |attribute| %>
          <th class="<%= attribute %>"><%= CustomerDatum.human_attribute_name(attribute) %></th>
          <% end %>
        </tr>
      </thead>

      <tbody>
        <%= render 'customer_data/list_body' %>
      </tbody>
    </table>
  </div>

  <%== pagy_bulma_nav(@pagy) %>
</div>
